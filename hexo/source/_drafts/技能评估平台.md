---
abbrlink: a14955d3
---
## 项目介绍

这个项目是用于中山大学附属第一医院的医生技能评估，我负责项目前后端的设计和实现，采用shiro框架实现多角色的登录认证和权限管理，应用spring的schedule定时清理无用数据，使用了poi等实现了成绩导出，支持pdf和excel格式，echarts做成绩等数据的可视化图表和分析，并有完善的日志信息记录和异常告警模块。项目上线至今已经经过了多场百人甚至千人的考试，体现出了无纸化考试的优点，提高了医院医师的工作效率，减少了资源的浪费。



## 定时任务的应用

### 为什么选Spring自带的

针对业务较简单，所以选用轻量级的易用的，因为Schedule使用简单，在方法上使用注解scheduled加cron表达式即可。

缺点：不适用于任务多，间隔短的情况，因为第一个任务执行未完成时将会导致第二个任务延迟执行。

cron表达式：秒分时日月周(年) 允许取值分别为该时间下的可选值(如秒为0-59) 

特殊取值：*任意，10-12：10秒到12秒，MON,FRI:表示星期一和五，5/15：从5开始每15执行一次。

quartz：非spring自带，主要组件有job任务，trigger触发器，schedule定时器-可装配多个触发器，需要经过配置注入到spring容器中，并且支持分布式事务。

### springschedule实现原理

ScheduledTaskRegistrar 定时任务注册器，在bean初始化后，会将所有带Schedule注解的方法注册到注册器中

Schedule注解属性：cron-表达式，fixDelay-固定延迟、本次执行开始和上次执行结束之间延迟的毫秒，fixRate-固定频率、以固定的时间间隔执行，initialDelay-延迟任务的初始延迟毫秒数

localExecutor：使用ScheduledThreadPoolExecutor实现，单线程执行，内部采用的是延迟队列DelayQueue。由于是单线程执行，因此不适用于任务多，间隔短的情况，因为第一个任务执行未完成时将会导致第二个任务延迟执行。

## 登录认证权限框架

### 为什么选shiro

登录认证权限管理主要都是通过过滤器来实现对应的逻辑，shiro在设计上比springSecurity简单许多，不需要繁杂的配置，再加上SpringSecurity功能更加丰富，因此其设计上会更加复杂，上手起来会比较困难，由于只需要认证和鉴权两个核心功能，因此选择了更加轻量级的shiro。

RBAC:基于角色的权限管理，通过用户的角色与其对应的权限实现权限安全管理。

##  JWTtoken和其他认证的比较

jwt是一种身份认证的机制，使用jwt可以在客户端和服务端建立起可靠的通信。

### 组成

1. header头部-jwt和加密算法
2. payload-设置token信息主题 用户id以及其他信息签发时间签发者过期时间等
3. signature-使用非对称加密算法将base64加密过的头部和payload再次通过密钥加密后就可以生成token。解析时也是一样，只需要验证token即可判断是否登录

### 单点登录：在不同的系统之间，只需要登录一次，就能访问其他相互信任的系统。

同域：通过cookie的顶域，和session共享实现

不同域：用户访问a系统时，a服务端发现未登录，重定向到单点登录系统，在单点登录系统中完成登录后，会有全局的状态保存，再生成一个凭据回发给a系统，a系统将再发送请求验证凭据的有效性，验证通过后，登陆系统会记录a系统的地址和sessionid，通过则将登陆信息保存在自己的服务端，完成登录。用户访问b系统时，b服务端发现未登录，重定向到单点登录系统，发现已登录，单点登录也生成一个凭据给b系统，b系统记录登录信息。

注销时，在子系统退出通过凭据到登陆系统删除全局session和子系统和sessionid进行删除