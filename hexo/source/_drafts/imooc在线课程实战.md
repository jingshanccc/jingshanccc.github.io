---
abbrlink: cf099fb5
---
## 项目介绍

这个项目是当时做了技能评估平台，说到一些实操的考试场景比如心肺复苏，可以用视频的方式来考核，但是后面医院那边又搁置了，所以我当时做了一些视频管理相关的实践，后来自己想着不能浪费了就结合了SpringCloud和Vue将它做成一个视频课程系统，在后台管理部分可以管理课程、讲师、文件、权限等，在视频平台提供了登陆注册、单点登录、视频点播等功能。



### 垂直分表的应用

课程内容的大文本字段，切分为新表，提高效率

在大字段/频繁更新的字段，可以应用垂直分表

## 文件分片上传

分片文件key标识属于哪个文件，key通过md5文件信息得到

通过转成10进制，再改成62进制得到更短的key

通过key也可以判断文件是否已经被上传实现极速上传，并通过已传输的分片实现断点续传

选择文件->校验文件->生成唯一标识->组装文件数据->调用文件上传校验接口查询文件记录->1.不存在，开始上传，递归直到所有分片上传完成 2. 存在，上传下一分片直到所有分片上传完成 3.存在，所有分片上传完成，显示极速上传成功 -> 1，2之后，合并分片，删除分片

### 为什么要使用base64编码传输文件？

计算机存储和操作时都是二进制序列，由于不同的设备对于字符的处理不同，有些二进制值在具体设备上代表不同的含义，因此传输二进制文本可能会导致某些不可见字符被错误传输，因此才有base64编码，因为经过BASE64编码后的字符串，全部都是由标准键盘上面的常规字符组成，这样编码后的字符串在传输过程中不会发生UNICODE字符串不能识别或者丢失的现象。在编码之后也可以用字符串形式对文件进行存储。

#### base64编码原理

将原字符对应的ASCII码值组成的二进制序列，每六位为转为64个字符中的一个。（2^6=64）

### 数据库的存储

表中使用字段shardIndex标识当前已上传到第几分片，当shardIndex为分配总数shardTotal时，进行合并分片操作。具体通过读取所有临时分片文件，写出到一个文件中。



## 登录注册

### 登录

1. 生成验证码token，存放验证码字符串以及token到缓存，返回验证码图片
2. 输入用户名、密码、验证码
3. 前端密码加密。调用登录
4. 后端加密密码
5. 获取验证码判断是否正确
6. 正确验证码后，清除redis数据
7. 查询用户是否存在
8. 用户存在则比较密码是否正确
9. 密码正确得到用户信息，生成token，存放到缓存（单点登录）
10. 返回用户信息，不返回密码
11. 保存用户信息到前端session
12. 记住我？是保存到localsession，否则清空local缓存

### 注册

发送短信验证码，60s不重发功能

## 权限管理

用户->角色，角色->资源

表设计：用户表、角色表、资源表、用户-角色表、角色-资源表

读取权限：登陆时加载所有权限

拦截：根绝资源所需的权限 判断当前是否拥有权限

1. 前端：菜单、路由、按钮、
2. 后端：接口、gateway过滤

权限初始化：以json形式记录所有资源

## 代码生成器



### 打包

将打包插件放到需要运行的模块，父模块不需要

